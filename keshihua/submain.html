<!DOCTYPE html>
<html lang="en" style="height: 100%">
<head>
  <meta charset="utf-8">
  <title>å­¦ä¹ è¡Œä¸ºå¯è§†åŒ–åˆ†æ</title>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.6.0/dist/echarts.min.js"></script>
  <style>
    body { font-family: sans-serif; margin: 40px; }
    .section { margin-bottom: 80px; }
    .chart { width: 600px; height: 500px; margin-top: 20px; }
    .kpi-card {
      width: 300px; /* å¢å¤§å¡ç‰‡å®½åº¦ */
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 20px;
      margin: 10px;
      box-shadow: 2px 2px 12px #aaa;
      display: inline-block;
    }
    .kpi-card h3 {
      margin: 0 0 10px 0; /* è°ƒæ•´æ ‡é¢˜å’Œæ®µè½ä¹‹é—´çš„é—´è· */
      font-size: 18px;
    }
    .kpi-card p {
      margin: 5px 0;
      font-size: 16px;
    }
    .kpi-chart {
      width: 100%;
      height: 150px; /* å¢å¤§å›¾è¡¨é«˜åº¦ */
    }
  </style>
</head>

<body>
  <div class="section">
    <h2>æ°”æ³¡å›¾</h2>
    <p>è®¡ç®—æ¯é“é¢˜çš„â€œå¹³å‡çŸ¥è¯†æŒæ¡åº¦ vs å¹³å‡å¾—åˆ†ç‡ vs å¹³å‡å°è¯•æ¬¡æ•°â€ï¼Œç”¨æ°”æ³¡å›¾ç›´è§‚å®šä½â€œè¿‡æ˜“/è¿‡éš¾/æ­§ä¹‰â€é¢˜ç›®ï¼Œå¹¶å¯ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…ã€‚</p>
    <div id="bubbleChart" class="chart"></div>

    <h2>å¾—åˆ†åˆ†å¸ƒç›´æ–¹å›¾</h2>
    <p>æ˜¾ç¤ºé¢˜ç›®çš„å¾—åˆ†åˆ†å¸ƒæƒ…å†µã€‚</p>
    <div id="scoreDistributionChart" class="chart" style="display:none;"></div>

    <h2>é”™è¯¯ç±»å‹é¥¼å›¾</h2>
    <p>æ˜¾ç¤ºä¸åŒé”™è¯¯ç±»å‹çš„åˆ†å¸ƒæƒ…å†µã€‚</p>
    <div id="errorTypeChart" class="chart" style="display:none;"></div>
  </div>

  <div class="section">
    <h2>å…³é”®æŒ‡æ ‡</h2>
    <div class="kpi-card">
      <h3>è–„å¼±çŸ¥è¯†ç‚¹æ•°</h3>
      <p>3</p>
      <div id="weakPointsChart" class="kpi-chart"></div>
    </div>
    <div class="kpi-card">
      <h3>è¿‡éš¾é¢˜ç›®æ•°</h3>
      <p>3</p>
      <div id="hardQuestionsChart" class="kpi-chart"></div>
    </div>
    <div class="kpi-card">
      <h3>è¿‡æ˜“é¢˜ç›®æ•°</h3>
      <p>5</p>
      <div id="easyQuestionsChart" class="kpi-chart"></div>
    </div>
    
    <div class="kpi-card">
      <h3>é«˜æ•ˆæ¨¡å¼æ¯”ç‡</h3>
      <p>25%</p>
      <div id="efficiencyChart" class="kpi-chart"></div>
    </div>
    <div class="kpi-card">
      <h3>å»ºè®®æ—¶æ®µ</h3>
      <p>19:00-21:00</p>
      <div id="suggestedTimeChart" class="kpi-chart"></div>
    </div>
  </div>

  <script>
    var bubbleChart = echarts.init(document.getElementById('bubbleChart'));
    var scoreDistributionChart = echarts.init(document.getElementById('scoreDistributionChart'));
    var errorTypeChart = echarts.init(document.getElementById('errorTypeChart'));

    fetch('keshihua/bubble_chart_data.json').then(res => res.json()).then(data => {
      var option = {
        title: {
          text: 'Bubble Chart'
        },
        tooltip: {
          trigger: 'item',
          formatter: function (params) {
            return `Title ID: ${params.data[3]}<br>Avg Knowledge Mastery: ${params.data[0].toFixed(2)}<br>Avg Score Rate: ${params.data[1].toFixed(2)}<br>Avg Attempts: ${params.data[2]}`;
          }
        },
        xAxis: {
          type: 'value',
          name: 'Avg Knowledge Mastery'
        },
        yAxis: {
          type: 'value',
          name: 'Avg Score Rate'
        },
        series: [{
          type: 'scatter',
          data: data.map(item => [item[1], item[2], item[3], item[0]]),
          symbolSize: function (data) {
            return Math.sqrt(data[2] / 10); // æ ¹æ®å°è¯•æ¬¡æ•°è°ƒæ•´æ°”æ³¡å¤§å°
          },
          itemStyle: {
            color: function (params) {
              var knowledgeMastery = params.value[0];
              var scoreRate = params.value[1];
              var attempts = params.value[2];
              // ç»¼åˆåˆ¤æ–­éš¾æ˜“ç¨‹åº¦
              if (knowledgeMastery < 0.4 && scoreRate < 0.1 && attempts > 1330) {
                return 'red'; // è¿‡éš¾
              } else if (knowledgeMastery > 1.0 && scoreRate > 0.3 && attempts < 1340) {
                return 'green'; // è¿‡æ˜“
              }
              return 'gray'; // é€‚ä¸­
            }
          }
        }]
      };
      bubbleChart.setOption(option);

      // æ³¨å†Œç‚¹å‡»äº‹ä»¶
      bubbleChart.on('click', function (params) {
        if (params.dataIndex !== null) {
          var titleId = params.data[3];
          document.getElementById('scoreDistributionChart').style.display = 'block';
          document.getElementById('errorTypeChart').style.display = 'block';

          fetch(`keshihua/score_distribution_data_${titleId}.json`).then(res => res.json()).then(scoreData => {
            var scoreOption = {
              title: {
                text: 'Score Distribution'
              },
              tooltip: {},
              xAxis: {
                type: 'category',
                data: Object.keys(scoreData)
              },
              yAxis: {
                type: 'value'
              },
              series: [{
                data: Object.values(scoreData),
                type: 'bar'
              }]
            };
            scoreDistributionChart.setOption(scoreOption);
          }).catch(err => {
            console.error('Error loading score distribution data:', err);
          });

          fetch(`keshihua/error_type_distribution_data_${titleId}.json`).then(res => res.json()).then(errorData => {
            var errorOption = {
              title: {
                text: 'Error Type Distribution'
              },
              tooltip: {
                trigger: 'item'
              },
              legend: {
                data: Object.keys(errorData)
              },
              series: [{
                name: 'Error Type',
                type: 'pie',
                radius: '55%',
                data: Object.values(errorData).map((value, key) => ({value: value, name: key}))
              }]
            };
            errorTypeChart.setOption(errorOption);
          }).catch(err => {
            console.error('Error loading error type distribution data:', err);
          });
        }
      });
    });

    var charts = {
      'weakPointsChart': {
        title: 'è–„å¼±çŸ¥è¯†ç‚¹æ•°',
        value: 3,
        total: 8,
        icon: 'â¬‡ï¸'
      },
      'hardQuestionsChart': {
        title: 'è¿‡éš¾é¢˜ç›®æ•°',
        value: 3,
        total: 44,
        icon: 'âš ï¸'
      },
      'easyQuestionsChart': {
        title: 'è¿‡æ˜“é¢˜ç›®æ•°',
        value: 5,
        total: 44,
        icon: 'âœ…'
      },
      
      'efficiencyChart': {
        title: 'é«˜æ•ˆæ¨¡å¼æ¯”ç‡',
        value: 25,
        total: 100,
        icon: 'ğŸ“ˆ'
      },
     'suggestedTimeChart': {
        
        value: 2, // å»ºè®®æ—¶æ®µä¸º2å°æ—¶
        total: 24, // å…¨å¤©24å°æ—¶
        icon: 'â°'
      }
    };

    for (var chartId in charts) {
      var chart = echarts.init(document.getElementById(chartId));
      if (chartId === 'suggestedTimeChart') {
        var option = {
          title: {
            text: charts[chartId].title,
            left: 'center',
        
        textStyle: {
          fontSize: 16,
          color: '#000'
        }
      },
      tooltip: {
        formatter: '{a} <br/>{b} : 19ï¼š00-21ï¼š00'
      },
      series: [
        {
          name: 'æ—¶æ®µ',
          type: 'gauge',
          startAngle: 90,
          endAngle: -270,
          min: 0,
          max: 12,
          center: ['50%', '50%'],
          radius: '80%',
          splitNumber: 12,
          axisLine: {
            lineStyle: {
              width: 8,
              color: [
                [7/12, '#CCCCCC'], // 7:00ä¹‹å‰ä¸ºç°è‰²
                [9/12, '#FFA500'], // 7:00-9:00 ä¸ºæ©™è‰²
                [1, '#CCCCCC']     // 9:00ä¹‹åä¸ºç°è‰²
              ]
            }
          },
          axisTick: {
            length: 6,
            lineStyle: {
              color: '#fff'
            }
          },
          axisLabel: {
            color: '#fff',
            distance: -30,
            formatter: function (value) {
              return value + ':00';
            }
          },
          splitLine: {
            length: 10,
            lineStyle: {
              width: 2,
              color: '#fff'
            }
          },
          pointer: {
            width: 5,
            length: '80%',
            itemStyle: {
              color: 'auto'
            }
          },
          detail: {
            valueAnimation: true,
            formatter: '19-21',
            offsetCenter: [0, '70%'],
            textStyle: {
              fontSize: 14,
              color: '#000'
            }
          },
          data: [
            {
              value: 8 , // 8:00 å¯¹åº”çš„å€¼
              name: 'å»ºè®®æ—¶æ®µ',
              title: {
                offsetCenter: [0, '30%'],
                textStyle: {
                  fontSize: 14,
                  color: '#000'
                }
              },
              detail: {
                valueAnimation: true,
                offsetCenter: [0, '70%']
                  }
                }
              ]
            }
          ]
        };
      } else {
        var option = {
          title: {
            text: charts[chartId].title,
            left: 'center'
          },
          tooltip: {
            trigger: 'item',
            formatter: '{a} <br/>{b}: {c} ({d}%)'
          },
          series: [
            {
              name: 'KPI',
              type: 'pie',
              radius: '50%',
              data: [
                {value: charts[chartId].value, name: charts[chartId].icon},
                {value: charts[chartId].total - charts[chartId].value, name: 'å…¶ä»–'}
              ],
              itemStyle: {
                color: function(params) {
                  return params.name === charts[chartId].icon ? '#FFA500' : '#CCCCCC';
                }
              }
            }
          ]
        };
      }
      chart.setOption(option);
    }
  </script>
</body>
</html>